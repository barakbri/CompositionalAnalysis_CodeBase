# Script 

library(biomformat)
file_path <- "E:/MCB2/MCB2/MCB_Simulation/gut_otu_table_sim.RData"
load(file_path)

#dim(otu_table)

Average_Cell_Count = c(99183906832,
                       217221266674,
                       151329659639,
                       90299128192,
                       95809600876,
                       132035763643,
                       39495621712,
                       119271846132,
                       138185802083,
                       121428187249,
                       145939517130,
                       224754815252,
                       72756226469,
                       35927546063,
                       107628776723,
                       130776743130,
                       41841212649,
                       22764340926,
                       172987119956,
                       46425487958,
                       153062883269,
                       95590999034,
                       208495566551,
                       53070915155,
                       18359008555,
                       70503715565,
                       58500810719,
                       89307497088,
                       147599455753,
                       19187237081,
                       217276666820,
                       253525709584,
                       25395316913,
                       22507873775,
                       142169041331,
                       116275992152,
                       142346591541,
                       161477761409,
                       5853245978,
                       47942791702,
                       28769973004,
                       168930811359,
                       126572467016,
                       117499264965,
                       116251948461,
                       177107799526,
                       74197893718,
                       48330742911,
                       203676977127,
                       187211301217,
                       174670957469,
                       75065628771,
                       54160688666,
                       165005851861,
                       215345198361,
                       150051113739,
                       191391240184,
                       20159773225,
                       38956568917,
                       123582072411,
                       98056602368,
                       184826494881,
                       54837809766,
                       70590688175,
                       132689255189,
                       98343121358)
  
  
  # c(197157541176,
  #                      218210059172,
  #                      125989847716,
  #                      NA,
  #                      126954277286,
  #                      117976608187,
  #                      293227315248,
  #                      210844305313,
  #                      75171752063,
  #                      152423729549,
  #                      157516564417,
  #                      221170483461,
  #                      272395113930,
  #                      141954022989,
  #                      185975975976,
  #                      74449786325,
  #                      55680000000,
  #                      273046796256,
  #                      118890855457,
  #                      184777251185,
  #                      216236263736,
  #                      161942278211,
  #                      227270498084,
  #                      118910256410,
  #                      304091615542,
  #                      214145922747,
  #                      125267489712,
  #                      185306772908,
  #                      94427892235,
  #                      241851598564,
  #                      188343589744,
  #                      80938406965,
  #                      217328755926,
  #                      89108527132,
  #                      147651226158,
  #                      100848484848,
  #                      263032855436,
  #                      273221957041,
  #                      37247377846,
  #                      81939437635)

otu_table = t(otu_table)
reordering_permutation = order(rownames(otu_table))
otu_table = otu_table[reordering_permutation,]
rownames(otu_table) #it is now ordered

X = otu_table#otu_table[-4,]
Average_Cell_Count = Average_Cell_Count#[-4]

prevalence_matrix = 1*(X>0)
total_counts_in_taxa = as.numeric(apply(prevalence_matrix,2,sum))
threshold = 4
to_keep = which(total_counts_in_taxa >= threshold) 
X2 = X[,to_keep]
#apply(X2,1,sum)
#min(apply(X2,1,sum))

qPCR_data = list()
qPCR_data$counts_matrix = X2
qPCR_data$qPCR_counts = Average_Cell_Count

save(qPCR_data,file = 'E:/MCB2/MCB2/MCB_Simulation/qPCR_data.RData')

